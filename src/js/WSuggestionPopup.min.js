WT_DECLARE_WT_MEMBER(1,JavaScriptConstructor,"WSuggestionPopup",function(s,g,y,G,q,t,z,u){function c(a){return $(a).hasClass("Wt-suggest-onedit")||$(a).hasClass("Wt-suggest-dropdown")}function d(){return g.style.display!="none"}function j(a){g.style.display="block";e.positionAtWidget(g.id,a.id,e.Vertical)}function h(a){a=e.target(a||window.event);if(!e.hasTag(a,"UL")){for(;a&&!e.hasTag(a,"LI");)a=a.parentNode;a&&p(a)}}function p(a){var b=a.firstChild.firstChild,i=e.getElement(f),l=b.innerHTML;b=b.getAttribute("sug");
i.focus();y(i,l,b);s.emit(g,"select",a.id,i.id);m();f=null}function m(){g.style.display="none";if(f!=null&&A!=null){e.getElement(f).onkeydown=A;A=null}}function B(a,b){for(a=b?a.nextSibling:a.previousSibling;a;a=b?a.nextSibling:a.previousSibling)if(e.hasTag(a,"LI"))if(a.style.display!="none")return a;return null}function J(a){var b=a.parentNode;if(a.offsetTop+a.offsetHeight>b.scrollTop+b.clientHeight)b.scrollTop=a.offsetTop+a.offsetHeight-b.clientHeight;else if(a.offsetTop<b.scrollTop)b.scrollTop=
a.offsetTop}$(".Wt-domRoot").add(g);g.wtObj=this;var r=this,e=s.WT,o=null,f=null,K=false,C=null,M=null,N=t,D=null,E=null,v=false;this.defaultValue=z;var A=null;this.showPopup=function(a){g.style.display="block";E=o=null;A=a.onkeydown;a.onkeydown=function(b){r.editKeyDown(this,b||window.event)}};this.editMouseMove=function(a,b){if(c(a))a.style.cursor=e.widgetCoordinates(a,b).x>a.offsetWidth-16?"default":""};this.showAt=function(a,b){m();f=a.id;v=true;r.refilter(b)};this.editClick=function(a,b){if(c(a))if(e.widgetCoordinates(a,
b).x>a.offsetWidth-16)if(f!=a.id||!d())r.showAt(a,"");else{m();f=null}};this.editKeyDown=function(a,b){if(!c(a))return true;if(f!=a.id)if($(a).hasClass("Wt-suggest-onedit")){f=a.id;v=false}else if($(a).hasClass("Wt-suggest-dropdown")&&b.keyCode==40){f=a.id;v=true}else{f=null;return true}var i=o?e.getElement(o):null;if(d()&&i)if(b.keyCode==13||b.keyCode==9){p(i);e.cancelEvent(b);setTimeout(function(){a.focus()},0);return false}else if(b.keyCode==40||b.keyCode==38||b.keyCode==34||b.keyCode==33){if(b.type.toUpperCase()==
"KEYDOWN"){K=true;e.cancelEvent(b,e.CancelDefaultAction)}if(b.type.toUpperCase()=="KEYPRESS"&&K==true){e.cancelEvent(b);return false}var l=i,F=b.keyCode==40||b.keyCode==34;b=b.keyCode==34||b.keyCode==33?g.clientHeight/i.offsetHeight:1;var n;for(n=0;l&&n<b;++n){var w=B(l,F);if(!w)break;l=w}if(l&&e.hasTag(l,"LI")){i.className="";l.className="active";o=l.id}return false}return b.keyCode!=13&&b.keyCode!=9};this.filtered=function(a,b){C=a;N=b;r.refilter(E)};this.refilter=function(a){if(f){var b=o?e.getElement(o):
null,i=e.getElement(f),l=G(i),F=g.childNodes,n=u&&a!=null?a:l(null);E=u?a:i.value;if(q>0||t)if(n.length<q&&!v){m();return}else{a=N?n:n.substring(0,Math.max(C!==null?C.length:0,q));if(a!=C)if(a!=M){M=a;s.emit(g,"filter",a)}}var w=a=null;n=v&&n.length==0;var x,O;x=0;for(O=F.length;x<O;++x){var k=F[x];if(e.hasTag(k,"LI")){var H=k.firstChild;if(k.orig==null)k.orig=H.firstChild.innerHTML;var I=l(k.orig),P=n||I.match;if(I.suggestion!=H.firstChild.innerHTML)H.firstChild.innerHTML=I.suggestion;if(P){if(k.style.display!=
"")k.style.display="";if(a==null)a=k;if(x==this.defaultValue)w=k}else if(k.style.display!="none")k.style.display="none";if(k.className!="")k.className=""}}if(a==null)m();else{if(!d()){j(i);r.showPopup(i);b=null}if(!b||b.style.display=="none"){b=w||a;b.parentNode.scrollTop=0;o=b.id}b.className="active";J(b)}}};this.editKeyUp=function(a,b){if(f!=null)if(c(a))if(!(!d()&&(b.keyCode==13||b.keyCode==9)))if(b.keyCode==27||b.keyCode==37||b.keyCode==39)m();else if(!(b.keyCode==40||b.keyCode==38||b.keyCode==
34||b.keyCode==33))if(a.value!=E){f=a.id;r.refilter(a.value)}else(a=o?e.getElement(o):null)&&J(a)};g.onclick=h;g.onscroll=function(){if(D){clearTimeout(D);var a=e.getElement(f);a&&a.focus()}};this.delayHide=function(a){D=setTimeout(function(){D=null;if(g&&(a==null||f==a.id))m()},300)}});
WT_DECLARE_WT_MEMBER(2,JavaScriptConstructor,"WSuggestionPopupStdMatcher",function(s,g,y,G,q,t,z){function u(c){var d=c.value;c=c.selectionStart?c.selectionStart:d.length;for(var j=y?d.lastIndexOf(y,c-1)+1:0;j<c&&G.indexOf(d.charAt(j))!=-1;)++j;return{start:j,end:c}}this.match=function(c){var d=u(c),j=c.value.substring(d.start,d.end),h;if(t.length==0)if(q.length!=0){h="(^|(?:[";for(c=0;c<q.length;++c){for(d=q.charCodeAt(c).toString(16);d.length<4;)d="0"+d;h+="\\u"+d}h+="]))"}else h="(^)";else h="("+
t+")";h+="("+j.replace(new RegExp("([\\^\\\\\\][\\-.$*+?()|{}])","g"),"\\$1")+")";h=new RegExp(h,"gi");return function(p){if(!p)return j;var m=false;if(j.length){var B=p.replace(h,"$1"+s+"$2"+g);if(B!=p){m=true;p=B}}return{match:m,suggestion:p}}};this.replace=function(c,d,j){d=u(c);var h=c.value.substring(0,d.start)+j+z;if(d.end<c.value.length)h+=c.value.substring(d.end,c.value.length);c.value=h;if(c.selectionStart){c.selectionStart=d.start+j.length+z.length;c.selectionEnd=c.selectionStart}}});
