WT_DECLARE_WT_MEMBER(3,JavaScriptConstructor,"ScrollVisibility",(function(e){const i=e.WT;function t(e){return"hidden"!==e.style.visibility&&"none"!==e.style.display&&!e.classList.contains("out")&&(!((e=e.parentNode)&&!i.hasTag(e,"BODY"))||t(e))}let n=0;const o={},s=!1;function l(e,n){if(!t(e))return!1;const o=i.widgetPageCoordinates(e),s=o.x-document.body.scrollLeft-document.documentElement.scrollLeft,l=o.y-document.body.scrollTop-document.documentElement.scrollTop,r=i.windowSize(),c=s,d=e.offsetWidth,f=l,b=e.offsetHeight,a=-n,v=r.x+2*n,u=-n,m=r.y+2*n;return c+d>=a&&a+v>=c&&f+b>=u&&u+m>=f}function r(){if(s)for(const i of Object.values(o)){const n=t(i.el);if(i.visibleIfNotHidden&&i.visible!==n){i.visible=n;e.emit(i.el,"scrollVisibilityChanged",n)}}else for(const i of Object.values(o)){const t=l(i.el,i.margin);if(t!==i.visible){i.visible=t;e.emit(i.el,"scrollVisibilityChanged",t)}}}function c(i){for(const n of i){const i=n.target,s=i.id,l=t(i);if(n.intersectionRatio>0||0!==n.intersectionRect.top||0!==n.intersectionRect.left){o[s].visibleIfNotHidden=!0;if(o[s].visible!==l){o[s].visible=l;e.emit(o[s].el,"scrollVisibilityChanged",l)}}else{o[s].visibleIfNotHidden=!1;if(o[s].visible){o[s].visible=!1;e.emit(o[s].el,"scrollVisibilityChanged",!1)}}}}const d=new MutationObserver(r);this.add=function(i){0===n&&function(){d.observe(document,{childList:!0,attributes:!0,subtree:!0,characterData:!0});if(!s){window.addEventListener("resize",r,!0);window.addEventListener("scroll",r,!0)}}();const t=i.el.id,f=t in o;s&&f&&o[t].observer&&o[t].observer.disconnect();const b=l(i.el,i.margin);if(i.visible!==b){i.visible=b;e.emit(i.el,"scrollVisibilityChanged",b)}o[t]=i;if(s){const e=new IntersectionObserver(c,{rootMargin:i.margin+"px"});e.observe(i.el);o[t].observer=e}f||++n};this.remove=function(e){if(0!==n){if(e in o){s&&o[e].observer&&o[e].observer.disconnect();delete o[e];--n}0===n&&function(){d.disconnect();if(!s){window.removeEventListener("resize",r,{capture:!0});window.removeEventListener("scroll",r,{capture:!0})}}()}}}));